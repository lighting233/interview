# xss
**跨站脚本攻击（XSS，Cross-Site Scripting）**是一种常见的网络安全漏洞，它允许攻击者向网页注入恶意代码（通常是 JavaScript）。当其他用户访问这些受感染的网页时，恶意脚本会在他们的浏览器中执行，导致数据泄露、会话劫持等安全问题。
- 攻击者提交恶意代码
- 浏览器执行恶意代码

### XSS 攻击的原理

XSS 攻击的核心原理是攻击者设法在网页中注入恶意脚本代码，浏览器在加载网页时错误地执行了这些代码。由于注入的代码在受害者的浏览器中执行，它可以访问受害者的页面内容、Cookie、会话信息等。XSS 攻击的发生主要是由于网页应用程序没有对用户输入进行适当的过滤或转义，导致恶意代码被嵌入到正常的网页中。

XSS 攻击的基本流程是：

1. 攻击者找到一个能够向网页注入数据的地方（如搜索框、表单、评论区等）。
2. 攻击者将恶意的 JavaScript 代码注入其中。
3. 当其他用户访问包含恶意代码的页面时，浏览器会执行这些脚本。
4. 攻击者可以利用这些脚本执行各种恶意操作，如窃取用户的 Cookie、伪造用户行为、展示欺骗性内容等。

### XSS 攻击的类型

XSS 攻击主要有三种类型：

#### 1. **存储型 XSS（Stored XSS）**
存储型 XSS 是最危险的一种 XSS 攻击，攻击者将恶意代码存储在目标服务器上。当其他用户访问受影响的页面时，这段恶意代码会自动执行。

**攻击步骤：**
- 攻击者通过表单提交、评论或其他可以存储用户输入的功能，将恶意脚本注入到网站。
- 这些恶意脚本被存储在服务器的数据库中。
- 当受害者访问包含恶意内容的页面时，恶意脚本从服务器读取并执行。

**存储型 XSS 示例：**
攻击者在一个评论区输入了以下代码：
```html
<script>alert('XSS Attack!');</script>
```
当其他用户访问该评论区时，浏览器会执行 `alert('XSS Attack!')`，而不是简单地显示评论内容。

#### 2. **反射型 XSS（Reflected XSS）**
反射型 XSS 是通过用户请求的即时响应来执行的。攻击者将恶意代码包含在 URL 中，诱使用户点击该链接。一旦用户点击，恶意脚本立即执行。

**攻击步骤：**
- 攻击者创建一个恶意 URL，其中包含恶意的脚本。
- 攻击者通过社交工程手段诱骗受害者点击该链接。
- 当受害者访问该链接时，服务器会将恶意代码反射回页面，并在浏览器中执行。

**反射型 XSS 示例：**
攻击者生成一个如下的恶意 URL：
```
http://vulnerable-site.com/search?q=<script>alert('Hacked!');</script>
```
当受害者访问该链接时，搜索结果页面会将输入的 `q` 参数直接显示在页面上，而没有适当的转义，从而导致 JavaScript 执行。

#### 3. **DOM 型 XSS（DOM-based XSS）**
DOM 型 XSS 发生在客户端，具体是通过修改页面的 DOM 结构执行恶意代码。它不依赖服务器端的响应，脚本是在客户端的浏览器环境中执行的。

**攻击步骤：**
- 攻击者创建一个恶意 URL，通常包含会被 JavaScript 处理的输入数据。
- 当受害者访问该 URL 时，页面的 JavaScript 代码解析并操作这个输入，导致恶意代码在页面上执行。

**DOM 型 XSS 示例：**
假设网页中的 JavaScript 代码如下：
```javascript
document.write(location.href);
```
攻击者可以构造如下的 URL：
```
http://vulnerable-site.com/#<script>alert('DOM XSS!');</script>
```
浏览器会根据 URL 中的片段 `#<script>alert('DOM XSS!');</script>` 执行脚本。

### XSS 攻击的潜在危害

- **窃取用户的 Cookie 和会话信息**：攻击者可以通过 XSS 盗取用户的身份验证 Cookie，从而冒充用户执行各种操作。
- **伪造用户行为**：攻击者可以通过脚本伪造用户点击或提交表单。
- **内容篡改和信息泄露**：攻击者可以通过 XSS 改变页面的外观，诱骗用户输入敏感信息。
- **分发恶意软件**：攻击者可以通过 XSS 分发恶意软件，让用户下载并运行恶意代码。

### 防御措施
#### 考虑三个方面
1. 尽量不要让脚本构造成功
   1. 在纯前端渲染中，我们会明确的告诉浏览器：下面要设置的内容是文本（`innerText`），还是属性（`setAttribute`），还是样式（`.style`）等等。浏览器不会被轻易的被欺骗，执行预期外的代码了。
   2. 避免使用 `eval()` 和 `innerHTML`
   3. 避免 DOM 型 XsS 漏洞（例如 `onload` 事件和 `href` 中的 `javascript:xxx` 等。
   4. 服务端渲染使用成熟的模版引擎,使用`js-xss`等成熟的转义库
   5. 前端单页应用使用react,vue等
2. 如果请求构造成功,尽量让请求不能发送: `Content-Security-Policy`
3. 如果发送了请求,不要让脚本轻易获取用户信息: 对敏感的 Cookie（如身份验证 Cookie）设置 `HttpOnly` 和 `Secure` 标志，防止它们被 JavaScript 访问
