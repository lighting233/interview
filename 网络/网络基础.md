[TOC]
# 网络基础

## 一、什么是URL,URI,encodeURI,encodeURIComponent?

### URL 和 URI

1. **URI（Uniform Resource Identifier）**：
   - URI 是一种用于标识资源的字符串，可以是 URL 或 URN（Uniform Resource Name）。**URI 的作用是唯一地标识某个资源**。
   - 例如，`http://example.com` 和 `urn:isbn:0451450523` 都是 URI。

2. **URL（Uniform Resource Locator）**：
   - URL 是一种**特定类型的 URI**，它不仅标识资源，还提供了**获取该资源的方式**（例如，通过 **HTTP、FTP 等协议**）。
   - URL 通常包含协议、主机名、路径和可选的查询参数。例如，`http://example.com/path/to/resource?query=123` 是一个 URL。

    #### URL⼀般包括⼏⼤部分：
    1. protocol，协议头，譬如有http，ftp等
    2. host，主机域名或IP地址
    3. port，端⼝号
    4. path，⽬录路径
    4. query，即查询参数
    5. fragment，即 #后的hash值，⼀般⽤来定位到某个位置

---

### `encodeURI` 和 `encodeURIComponent`

这两个函数用于对 URI 进行编码，以确保其在网络传输中不会出现问题。

1. **`encodeURI`**：
   - 用于对整个 URI 进行编码。它会对 URI 中的某些字符进行编码，但不会对某些特殊字符（如 `:`, `/`, `?`, `&`, `=` 等）进行编码，因为这些字符在 URI 中是有特定含义的。
   - 例如：
    ```javascript
    const url = "http://example.com/path?name=张三&age=20";
    const encodedUrl = encodeURI(url);
    console.log(encodedUrl); 
    // 输出: "http://example.com/path?name=张三&age=20"
    ```
    ==中文在 url 中非法，需要转义==
2. **`encodeURIComponent`**：
   - 用于对 URI 的某个组件（如查询参数）进行编码。它会对所有特殊字符进行编码，以确保它们不会干扰 URI 的结构。
   - 例如：
    ```javascript
    const name = "张三";
    const age = 20;
    const encodedName = encodeURIComponent(name);
    const url = `http://example.com/path?name=${encodedName}&age=${age}`;
    console.log(url);
    // 输出: "http://example.com/path?name=%E5%BC%A0%E4%B8%89&age=20"
    ```
    ==在这个例子中，encodeURIComponent 编码了 name 参数的值，确保它在 URL 中是合法的，即使这个值包含特殊字符。==
- **为什么有些场景用 encodeURI 而不能用 encodeURIComponent？**
使用 encodeURI 的场景通常涉及到完整 URL 的处理。因为 encodeURI 不会编码那些在 URL 中有特殊意义的字符（如 ?, &, = 等），它能确保 URL 的结构不被破坏。而如果用 encodeURIComponent 来处理整个 URL，这些特殊字符都会被编码，导致浏览器或服务器无法正确解析这个 URL。

**正确示例：**
```javascript
const uri = "http://example.com/path?name=John Doe";
const encodedURI = encodeURI(uri);
console.log(encodedURI); // "http://example.com/path?name=John%20Doe"
```

**错误示例：**
```javascript
const url = "http://example.com/path?name=张三&age=20";
const encodedUrl = encodeURIComponent(url);
console.log(encodedUrl);
// 输出: "http%3A%2F%2Fexample.com%2Fpath%3Fname%3D%E5%BC%A0%E4%B8%89%26age%3D20"
```
>这个结果中，整个 URL 被编码为一个字符串，所有的特殊字符都被转义，导致它不再是一个合法的 URL。
---
- **为什么有些场景用 encodeURIComponent 而不能用 encodeURI？**
当你只需要对 URI 的一部分（如查询参数的值）进行编码时，使用 encodeURIComponent。因为 encodeURI 不会编码某些特殊字符，如 &, =, ? 等，而这些字符在查询参数中可能导致歧义或错误的解析，所以必须使用 encodeURIComponent 来确保这些字符被正确编码。


>链接内包含一个回调地址，回调地址是另外一个URL，此时我们就需要使用encodeURIComponent()对回调地址进行转码，这样一来，URL中就不会出现多个http://，多个&这样的特殊字符；方便对回调地址进行处理；以上链接处理如下：
```javascript
// 对URL中的回调链接进行转码
'https://www.baidu.com/s?returnURL=' +encodeURIComponent('http://www.test.com/')
//输出: "https://www.baidu.com/s?returnURL=http%3A%2F%2Fwww.test.com%2F"
```

### 小结

- **URI** 是用于标识资源的字符串，可以是 URL 或 URN。
- **URL** 是一种特定的 URI，提供了获取资源的方法。
- **`encodeURI`** 用于编码整个 URI，而 **`encodeURIComponent`** 用于编码 URI 的某个组件。

---

## 二、域名
在互联网域名系统（DNS）中，域名的层级结构和命名规则是非常重要的。以下是关于域名、顶级域名、一级域名、二级域名、子域名的详细介绍，以及关于“根域名”的说明。
域名长度不能超过63个字符，不能使用特殊字符和空格。

### 1. **域名（Domain Name）**
- **定义**: 域名是互联网中用于标识和访问网站的文本地址。它是 IP 地址的用户友好表示形式，使得用户可以通过易于记忆的名称访问网站，而无需记住复杂的数字 IP 地址。

- **结构**: 域名由多个部分组成，这些部分由点 (`.`) 分隔，并形成一个层级结构。例如，`www.example.com` 就是一个完整的域名。

### 2. **顶级域名（Top-Level Domain, TLD）**
- **定义**: 顶级域名是域名系统中的最高级别，它位于域名的最右侧部分，直接在点 (`.`) 的右边。

- **类型**:
  - **通用顶级域名（gTLDs）**: 如 `.com`, `.org`, `.net`, `.info` 等，通常没有特定的国家或地区限制。
  - **国家/地区顶级域名（ccTLDs）**: 如 `.cn`（中国）, `.uk`（英国）, `.jp`（日本）等，通常与特定的国家或地区关联。

- **示例**:
  - `example.com` 中的 `.com` 就是顶级域名。
  - `example.cn` 中的 `.cn` 是国家/地区顶级域名。


### 3. **二级域名（Second-Level Domain, SLD）**
- 二级域名位于顶级域名之前，是常见的注册域名层级。在“www.example.com”中，“example”是二级域名，通常是企业、组织或个人根据自己的需求来注册的。


### 4. **三级域名或子域名（Subdomain）**
- 三级域名是建立在二级域名下的进一步细分。在“www.example.com”中，“www”是常见的三级域名或称为子域名，常用于区分不同类型的服务，如“mail.example.com”可能用于电子邮件服务，“blog.example.com”用于博客。

### 5. **关于“一级域名”与顶级域名的区别**

严格来说，**“一级域名”** 并不是一个标准的技术术语，而是一个在日常使用中产生的非正式概念。在域名系统（DNS）的标准定义中，没有“一级域名”这种说法。域名的正式层级结构通常包括：

1. **顶级域名（Top-Level Domain, TLD）**: 域名系统的最高层级。例如 `.com`、`.org`、`.net`、`.cn` 等。

2. **二级域名（Second-Level Domain, SLD）**: 紧跟在顶级域名之前的部分。通常是用户或企业注册的域名部分，例如 `example.com` 中的 `example`。

3. **三级域名及更低级别域名（Subdomains）**: 二级域名之前的部分，通常用于组织和管理网站的不同部分。例如 `blog.example.com` 中的 `blog`。

#### 关于“一级域名”与顶级域名的区别

- **顶级域名 (TLD)** 是一个技术术语，明确指域名的最高层级，如 `.com`、`.net`、`.cn`。

- **“一级域名”** 这个说法在非正式语境中，通常指的是我们平时注册的域名（例如 `example.com`），即顶级域名和它前面的部分组成的域名。它并不等同于顶级域名，而是包括了顶级域名和一个二级域名。

#### 结论

- **顶级域名** 是 DNS 中的标准术语，指域名层级的最高部分，如 `.com` 或 `.cn`。
- **“一级域名”** 在技术上并不是一个标准术语，通常用于指代注册的域名（如 `example.com`），包含了顶级域名和前面的部分（即二级域名）。

因此，“一级域名” 和 “顶级域名” 不是同一个概念。顶级域名是标准的技术术语，而一级域名更多是一个非正式的说法，指注册的域名本身。

### 6. **根域名（Root Domain）**
- **定义**: 在域名系统中，根域名（或根域）是位于 DNS 层级结构的顶端，通常被表示为空字符串（即最后一个点 `.`）。根域名通常不显示在常规浏览器输入的 URL 中，但它存在于 DNS 系统的背景中。

- **根域名的作用**: 
  - 顶级域名（如 `.com`, `.org` 等）都属于根域的下一级。在实际使用中，根域名很少被直接提及，因为它隐含在 DNS 系统中。

- **示例**: 
  - `example.com.` 其实完整的形式是 `example.com.`，最后的 `.` 表示根域名，但在使用中通常省略。

### **总结**
- **域名** 是网站在互联网上的地址，由多个部分组成。
- **顶级域名 (TLD)** 是域名的最高级部分，如 `.com`, `.cn`。
- **二级域名（Second-Level Domain, SLD）** 二级域名位于顶级域名之前。
- **根域名** 是 DNS 层级结构的顶端，通常隐含在完整的域名结构中，不直接显示。

---

## 三.`OSI`七层模型 (Open System Interconnection)

OSI（开放系统互连，Open Systems Interconnection）七层模型是由国际标准化组织（ISO）制定的一个参考模型，用于描述计算机网络系统中的通信功能。该模型将网络通信过程分为七个独立的层次，每一层都有特定的功能和协议。

### OSI 七层模型

1. **物理层（Physical Layer）**
   - **功能**: 物理层负责在物理介质上传输原始的比特流（0和1），包括定义硬件设备的电气、机械、光学接口。
   - **协议和标准**:
     - IEEE 802.3（以太网）
     - RS-232（串口通信）
     - 光纤传输协议（如SONET/SDH）
     - 无线电频率（RF）信号标准

2. **数据链路层（Data Link Layer）**
   - **功能**: 数据链路层负责将物理层传输的比特组织成数据帧，并进行错误检测、纠正和流量控制。它确保点到点的可靠传输。
   - **协议和标准**:
     - 以太网（Ethernet，IEEE 802.3）
     - 点对点协议（PPP）
     - 高级数据链路控制（HDLC）
     - 虚拟局域网（VLAN，IEEE 802.1Q）

3. **网络层（Network Layer）**
   - **功能**: 网络层负责逻辑地址的分配和路由选择，决定数据如何在网络中转发，实现不同网络之间的互联。
   - **协议和标准**:
     - ARP 从`ip`地址获取mac地址  （局域网） 
     - IP（互联网协议，IPv4、IPv6）
     - ICMP（Internet控制报文协议）
     - OSPF（开放最短路径优先）
     - BGP（边界网关协议）

4. **传输层（Transport Layer）**
   - **功能**: 传输层提供端到端的通信管理，包括建立连接、数据传输、流量控制、错误检测与恢复等，确保数据的可靠传输。
   - **协议和标准**:
     - TCP（传输控制协议）
     - UDP（用户数据报协议）
     - SCTP（流控制传输协议）

5. **会话层（Session Layer）**
   - **功能**: 会话层负责建立、管理和终止应用程序之间的会话。它负责对话控制和数据同步。
   - **协议和标准**:
     - NetBIOS（网络基本输入输出系统）
     - PPTP（点对点隧道协议）
     - RPC（远程过程调用）

6. **表示层（Presentation Layer）**
   - **功能**: 表示层负责数据的格式化、加密、解密和压缩等。它确保应用层发送的数据能被接收端正确理解。
   - **协议和标准**:
     - JPEG（图像压缩）
     - ASCII（文本编码）
     - SSL/TLS（安全套接字层/传输层安全）
     - MPEG（视频压缩）

7. **应用层（Application Layer）**
   - **功能**: 应用层为用户提供直接的网络服务接口，处理用户交互和应用程序功能。它是用户与网络之间的桥梁。
   - **协议和标准**:
     - HTTP/HTTPS（超文本传输协议/安全超文本传输协议）
     - FTP（文件传输协议）
     - SMTP（简单邮件传输协议）
     - DNS（域名系统）
     - SNMP（简单网络管理协议）

### 总结
- **物理层**: 负责物理传输。
- **数据链路层**: 负责点到点的可靠传输。
- **网络层**: 负责路由选择和跨网络通信。
- **传输层**: 负责端到端的可靠传输和流量控制。
- **会话层**: 负责会话管理和控制。
- **表示层**: 负责数据的格式化、加密、解密和压缩。
- **应用层**: 负责应用程序间的通信。

每一层都有特定的协议集，确保网络通信的顺利进行。OSI 七层模型不仅是一个理论模型，也是理解网络通信基础的有力工具。

---

**用送快递的过程来比喻OSI七层模型的每一层，可以帮助更直观地理解各层的作用。我们将把数据传输的过程比作从发件人到收件人发送快递的过程。**

#### 1. **物理层（Physical Layer）——快递车在道路上行驶**
   - **比喻**: 物理层就像是快递车在公路上行驶，它负责实际的运输过程。快递车可以在不同的道路上行驶，这类似于不同的物理媒介（如电缆、光纤或无线电波）传输比特流。
   - **作用**: 确保快递能够从一个地方物理地移动到另一个地方。

#### 2. **数据链路层（Data Link Layer）——确保包裹完整、无损坏地装车**
   - **比喻**: 数据链路层就像是快递员在装车前检查包裹，确保包裹在运输过程中不丢失、不损坏，并且每个包裹都有正确的标签。这类似于数据帧的传输和错误检测。
   - **作用**: 确保每个包裹（数据帧）在运输过程中被正确识别和传输。

#### 3. **网络层（Network Layer）——规划送货路线**
   - **比喻**: 网络层就像是快递公司的调度中心，它根据目的地为快递选择最佳的送货路线，决定每辆快递车的行驶路径。这类似于IP地址的路由选择过程。
   - **作用**: 确保包裹按照最佳路线送达目的地（通过网络选择路径）。

#### 4. **传输层（Transport Layer）——确保送达每个收件人**
   - **比喻**: 传输层就像是负责快递投递的快递员，确保每个包裹准确无误地送到收件人手中。如果包裹在运输中丢失，会及时通知并重新发送。这类似于传输层协议（如TCP）提供的可靠传输、流量控制和错误恢复。
   - **作用**: 确保包裹安全、可靠地送达正确的收件人。

#### 5. **会话层（Session Layer）——管理和协调送货的交接过程**
   - **比喻**: 会话层就像是快递员与收件人之间的沟通，确定何时送货、何时交接。如果收件人不在家，会话层负责安排重新送货或确认是否可以将包裹交给邻居。这类似于会话层管理和控制通信会话的开始、保持和终止。
   - **作用**: 管理和协调整个送货过程中的交互和会话。

#### 6. **表示层（Presentation Layer）——确认包裹内容的正确性和可识别性**
   - **比喻**: 表示层就像是确保包裹内容是正确的，并且收件人能够理解和使用（如检查包裹的文件格式，确保能够被打开）。这类似于数据格式的转换、加密和解密。
   - **作用**: 确保数据（包裹的内容）在发送和接收时的格式正确，并且能够被正确解释。

#### 7. **应用层（Application Layer）——收件人收到并使用包裹**
   - **比喻**: 应用层就像是收件人打开包裹并使用里面的内容，比如收件人打开一个包裹，看里面的书或者使用包裹中的产品。这类似于应用程序直接与用户交互，处理实际的网络通信任务。
   - **作用**: 提供用户直接使用的网络服务，如网页浏览、邮件接收等。

#### 总结
通过这个比喻，OSI七层模型的每一层可以被理解为快递运输中的一个重要环节，从物理运输（物理层），到包裹的管理（数据链路层和网络层），再到确保包裹正确送达（传输层），直到最终交付给用户（应用层）。每一层都有特定的角色，确保数据（包裹）能够顺利、安全地从发送方到达接收方。

## 四、DNS 解析过程

DNS（域名系统，Domain Name System）解析是将用户输入的域名转换为对应IP地址的过程，这样用户可以通过域名访问网站而不需要记住IP地址。DNS解析的过程涉及多个步骤，下面详细介绍这个过程。

### DNS解析的详细过程

1. **用户查询（客户端发起请求）**
   - 当用户在浏览器中输入域名（例如 `www.example.com`）并按下回车时，客户端（用户的计算机）会首先检查本地缓存中是否有该域名对应的IP地址。如果有缓存记录，则直接使用该IP地址访问目标服务器；如果没有，则进行DNS查询。

2. **查询本地DNS服务器（递归解析器）**
   - 如果本地没有缓存记录，客户端会将查询请求发送到本地DNS服务器（通常由互联网服务提供商（ISP）提供）。本地DNS服务器被称为递归解析器，它负责代表客户端向DNS层次结构查询IP地址。

3. **查询根域名服务器**
   - 本地DNS服务器首先会查询根域名服务器。根域名服务器是DNS层次结构的顶级服务器，掌握顶级域名（TLD）的信息。根域名服务器不会直接返回最终的IP地址，但会指引递归解析器去查询正确的顶级域名服务器（如负责 `.com` 域的服务器）。

4. **查询顶级域名服务器（TLD服务器）**
   - 递归解析器根据根域名服务器的指引，接着查询相应的顶级域名服务器。例如，查询 `www.example.com` 时，递归解析器会查询 `.com` 顶级域名服务器。TLD服务器会返回负责 `example.com` 的权威DNS服务器的地址。

5. **查询权威DNS服务器**
   - 递归解析器根据TLD服务器返回的信息，查询具体的权威DNS服务器（即管理 `example.com` 域的DNS服务器）。权威DNS服务器会返回最终的IP地址（例如 `93.184.216.34`）给递归解析器。

6. **返回IP地址给客户端**
   - 递归解析器将权威DNS服务器返回的IP地址缓存一段时间，并将结果返回给客户端。客户端收到IP地址后，可以使用该IP地址与目标服务器建立连接。

7. **客户端访问目标服务器**
   - 客户端使用获得的IP地址，向目标服务器发送HTTP请求，最终加载并显示网页内容。

### DNS解析过程的简化图示

```
用户输入域名
       ↓
客户端查询本地缓存
       ↓
查询本地DNS服务器（递归解析器）
       ↓
查询根域名服务器
       ↓
根域名服务器指引查询顶级域名服务器
       ↓
顶级域名服务器指引查询权威DNS服务器
       ↓
权威DNS服务器返回IP地址
       ↓
递归解析器缓存并返回IP地址给客户端
       ↓
客户端使用IP地址访问目标服务器
       ↓
显示网页内容
```

### 补充说明
- **缓存**: 为了提高查询速度，DNS查询过程中各个环节都会缓存结果一段时间，包括客户端、本地DNS服务器和权威DNS服务器。缓存有效期由TTL（生存时间，Time To Live）值决定。
  
- **递归查询和迭代查询**: 本地DNS服务器与客户端之间的查询通常是递归的（即本地DNS服务器负责完成整个查询过程），而本地DNS服务器与其他DNS服务器之间的查询通常是迭代的（即DNS服务器返回下一步应该查询的服务器地址）。

通过这个过程，用户能够通过输入易记的域名访问到网站，而实际的通信是通过IP地址完成的。DNS解析是互联网正常运作的基础服务之一。